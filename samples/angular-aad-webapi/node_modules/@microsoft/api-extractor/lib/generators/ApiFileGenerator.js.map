{"version":3,"sources":["generators/ApiFileGenerator.ts"],"names":[],"mappings":"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","file":"generators/ApiFileGenerator.js","sourcesContent":["import * as fs from 'fs';\r\nimport Extractor from '../Extractor';\r\nimport ApiStructuredType from '../definitions/ApiStructuredType';\r\nimport ApiEnum from '../definitions/ApiEnum';\r\nimport ApiEnumValue from '../definitions/ApiEnumValue';\r\nimport ApiFunction from '../definitions/ApiFunction';\r\nimport ApiItem, { ApiItemKind } from '../definitions/ApiItem';\r\nimport ApiItemVisitor from '../ApiItemVisitor';\r\nimport ApiPackage from '../definitions/ApiPackage';\r\nimport ApiParameter from '../definitions/ApiParameter';\r\nimport ApiMember from '../definitions/ApiMember';\r\nimport IndentedWriter from '../IndentedWriter';\r\nimport { ApiTag } from '../definitions/ApiDocumentation';\r\n\r\n/**\r\n  * For a library such as \"example-package\", ApiFileGenerator generates the \"example-package.api.ts\"\r\n  * report which is used to detect API changes.  The output is pseudocode whose syntax is similar\r\n  * but not identical to a \"*.d.ts\" typings file.  The output file is designed to be committed to\r\n  * Git with a branch policy that will trigger an API review workflow whenever the file contents\r\n  * have changed.  For example, the API file indicates *whether* a class has been documented,\r\n  * but it does not include the documentation text (since minor text changes should not require\r\n  * an API review).\r\n  */\r\nexport default class ApiFileGenerator extends ApiItemVisitor {\r\n  protected _indentedWriter: IndentedWriter = new IndentedWriter();\r\n\r\n  /**\r\n   * We don't want to require documentation for any properties that occur\r\n   * anywhere within a TypeLiteral. If this value is above 0, then we are\r\n   * visiting something within a TypeLiteral.\r\n   */\r\n  private _insideTypeLiteral: number;\r\n\r\n  /**\r\n   * Compares the contents of two API files that were created using ApiFileGenerator,\r\n   * and returns true if they are equivalent.  Note that these files are not normally edited\r\n   * by a human; the \"equivalence\" comparison here is intended to ignore spurious changes that\r\n   * might be introduced by a tool, e.g. Git newline normalization or an editor that strips\r\n   * whitespace when saving.\r\n   */\r\n  public static areEquivalentApiFileContents(actualFileContent: string, expectedFileContent: string): boolean {\r\n    // NOTE: \"\\s\" also matches \"\\r\" and \"\\n\"\r\n    const normalizedActual: string = actualFileContent.replace(/[\\s]+/g, ' ');\r\n    const normalizedExpected: string = expectedFileContent.replace(/[\\s]+/g, ' ');\r\n    return normalizedActual === normalizedExpected;\r\n  }\r\n\r\n  /**\r\n   * Generates the report and writes it to disk.\r\n   *\r\n   * @param reportFilename - The output filename\r\n   * @param analyzer       - An Analyzer object representing the input project.\r\n   */\r\n  public writeApiFile(reportFilename: string, extractor: Extractor): void {\r\n    const fileContent: string = this.generateApiFileContent(extractor);\r\n    fs.writeFileSync(reportFilename, fileContent);\r\n  }\r\n\r\n  public generateApiFileContent(extractor: Extractor): string {\r\n    this._insideTypeLiteral = 0;\r\n    // Normalize to CRLF\r\n    this.visit(extractor.package);\r\n    const fileContent: string = this._indentedWriter.toString().replace(/\\r?\\n/g, '\\r\\n');\r\n    return fileContent;\r\n  }\r\n\r\n  protected visitApiStructuredType(apiStructuredType: ApiStructuredType): void {\r\n    const declarationLine: string = apiStructuredType.getDeclarationLine();\r\n\r\n    if (apiStructuredType.documentation.preapproved) {\r\n      this._indentedWriter.writeLine('// @internal (preapproved)');\r\n      this._indentedWriter.writeLine(declarationLine + ' {');\r\n      this._indentedWriter.writeLine('}');\r\n      return;\r\n    }\r\n\r\n    if (apiStructuredType.kind !== ApiItemKind.TypeLiteral) {\r\n      this._writeJsdocSynopsis(apiStructuredType);\r\n    }\r\n\r\n    this._indentedWriter.writeLine(declarationLine + ' {');\r\n\r\n    this._indentedWriter.indentScope(() => {\r\n      if (apiStructuredType.kind === ApiItemKind.TypeLiteral) {\r\n        // Type literals don't have normal JSDoc.  Write only the warnings,\r\n        // and put them after the '{' since the declaration is nested. \r\n        this._writeWarnings(apiStructuredType);\r\n      }\r\n\r\n      for (const member of apiStructuredType.getSortedMemberItems()) {\r\n        this.visit(member);\r\n        this._indentedWriter.writeLine();\r\n      }\r\n    });\r\n\r\n    this._indentedWriter.write('}');\r\n  }\r\n\r\n  protected visitApiEnum(apiEnum: ApiEnum): void {\r\n    this._writeJsdocSynopsis(apiEnum);\r\n\r\n    this._indentedWriter.writeLine(`enum ${apiEnum.name} {`);\r\n\r\n    this._indentedWriter.indentScope(() => {\r\n      const members: ApiItem[] = apiEnum.getSortedMemberItems();\r\n      for (let i: number = 0; i < members.length; ++i) {\r\n        this.visit(members[i]);\r\n        this._indentedWriter.writeLine(i < members.length - 1 ? ',' : '');\r\n      }\r\n    });\r\n\r\n    this._indentedWriter.write('}');\r\n  }\r\n\r\n  protected visitApiEnumValue(apiEnumValue: ApiEnumValue): void {\r\n    this._writeJsdocSynopsis(apiEnumValue);\r\n\r\n    this._indentedWriter.write(apiEnumValue.getDeclarationLine());\r\n  }\r\n\r\n  protected visitApiPackage(apiPackage: ApiPackage): void {\r\n    for (const apiItem of apiPackage.getSortedMemberItems()) {\r\n      this.visit(apiItem);\r\n      this._indentedWriter.writeLine();\r\n      this._indentedWriter.writeLine();\r\n    }\r\n\r\n    this._writeJsdocSynopsis(apiPackage);\r\n  }\r\n\r\n  protected visitApiMember(apiMember: ApiMember): void {\r\n    if (apiMember.documentation) {\r\n      this._writeJsdocSynopsis(apiMember);\r\n    }\r\n\r\n    this._indentedWriter.write(apiMember.getDeclarationLine());\r\n\r\n    if (apiMember.typeLiteral) {\r\n      this._insideTypeLiteral += 1;\r\n      this.visit(apiMember.typeLiteral);\r\n      this._insideTypeLiteral -= 1;\r\n    }\r\n  }\r\n\r\n  protected visitApiFunction(apiFunction: ApiFunction): void {\r\n    this._writeJsdocSynopsis(apiFunction);\r\n    this._indentedWriter.write(apiFunction.getDeclarationLine());\r\n  }\r\n\r\n  protected visitApiParam(apiParam: ApiParameter): void {\r\n    throw Error('Not Implemented');\r\n  }\r\n\r\n  /**\r\n   * Writes a synopsis of the JSDoc comments, which indicates the API tag,\r\n   * whether the item has been documented, and any warnings that were detected\r\n   * by the Analzer.\r\n   */\r\n  private _writeJsdocSynopsis(apiItem: ApiItem): void {\r\n    this._writeWarnings(apiItem);\r\n    const lines: string[] = [];\r\n\r\n    if (apiItem instanceof ApiPackage && !apiItem.documentation.summary.length) {\r\n      lines.push('(No packageDescription for this package)');\r\n    } else {\r\n      let footer: string = '';\r\n      switch (apiItem.documentation.apiTag) {\r\n        case ApiTag.Internal:\r\n          footer += '@internal';\r\n          break;\r\n        case ApiTag.Alpha:\r\n          footer += '@alpha';\r\n          break;\r\n        case ApiTag.Beta:\r\n          footer += '@beta';\r\n          break;\r\n        case ApiTag.Public:\r\n          footer += '@public';\r\n          break;\r\n      }\r\n\r\n      // deprecatedMessage is initialized by default,\r\n      // this ensures it has contents before adding '@deprecated'\r\n      if (apiItem.documentation.deprecatedMessage.length > 0) {\r\n        if (footer) {\r\n          footer += ' ';\r\n        }\r\n        footer += '@deprecated';\r\n      }\r\n\r\n      // If we are anywhere inside a TypeLiteral, _insideTypeLiteral is greater than 0\r\n      if (this._insideTypeLiteral === 0 && apiItem.needsDocumentation) {\r\n        if (footer) {\r\n          footer += ' ';\r\n        }\r\n        footer += '(undocumented)';\r\n      }\r\n\r\n      if (footer) {\r\n        lines.push(footer);\r\n      }\r\n    }\r\n\r\n    this._writeLinesAsComments(lines);\r\n  }\r\n\r\n  private _writeWarnings(apiItem: ApiItem): void {\r\n    const lines: string[] = apiItem.warnings.map((x: string) => 'WARNING: ' + x);\r\n    this._writeLinesAsComments(lines);\r\n  }\r\n\r\n  private _writeLinesAsComments(lines: string[]): void {\r\n    if (lines.length) {\r\n      // Write the lines prefixed by slashes.  If there  are multiple lines, add \"//\" to each line\r\n      this._indentedWriter.write('// ');\r\n      this._indentedWriter.write(lines.join('\\n// '));\r\n      this._indentedWriter.writeLine();\r\n    }\r\n  }\r\n}\r\n"],"sourceRoot":"..\\..\\src"}